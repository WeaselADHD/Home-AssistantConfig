---
# Template binary sensors
platform: template
sensors:
  motion_detected_in_last_hour:
    friendly_name: Motion detected in last hour
    unique_id: motion_detected_in_last_hour
    value_template: >
      {{ expand('group.all_motion_sensors') | selectattr('state', 'eq', 'on') | list | count > 0 }}
    delay_off: "01:00:00"

  someone_in_the_house_in_last_hour:
    friendly_name: Someone in the house in the last hour
    unique_id: someone_in_the_house_in_last_hour
    value_template: >
      {{ is_state("binary_sensor.motion_detected_in_last_hour", "on")
        or is_state("group.persons", "home") }}

  activity_in_room:
    friendly_name: "Activity in {{ room }}"
    unique_id: "activity_in_{{ room | replace(' ', '_') }}"
    value_template: >
      {{ is_state("binary_sensor." ~ room | replace(' ', '_') ~ "_motion_sensor_occupancy", "on") }}
    delay_off: "00:02:00"
    for_each:
      - room: living room
      - room: kitchen
      - room: hallway
      - room: study
      - room: landing
      - room: attic
